import requests
import json
import pandas as pd
url = 'https://fred.stlouisfed.org/graph/api/series/?obs=True&sid=MORTGAGE30US'
data={"hostName":"fred.stlouisfed.org","series":{},"chart":{"labels":{"title":"30-Year Fixed Rate Mortgage Average in the United States","subtitle":"Source: Freddie Mac","left_axis":"Percent","right_axis":"","bottom_axis":"","bubble-size_axis":"","footer":"2025 fred.stlouisfed.org"},"cosd":"1971-04-02","coed":"2025-01-16","min_date":"1971-04-02","max_date":"2025-01-16","frequency":"Weekly","width":1140,"height":450,"drp":0,"stacking":None,"txtcolor":"#444444","mode":"fred","ts":12,"tts":12,"fo":"open sans","x_scale":"time","trc":0,"nt":0,"thu":0,"bgcolor":"#E1E9F0","graph_bgcolor":"#ffffff","showLegend":"yes","showAxisTitles":"yes","zoomType":"x","showTooltip":"yes","chartType":"line","recession_bars":"on","showNavigator":"True","available_chart_types":["line","area","column","scatter","pie","bubble"],"log_scales":{"left":False,"right":False,"bottom":False,"bubble-size":False},"available_stacking":["normal","percent"],"legacy_url":"bgcolor=%23E1E9F0&chart_type=line&drp=0&fo=open%20sans&graph_bgcolor=%23ffffff&height=450&mode=fred&recession_bars=on&txtcolor=%23444444&ts=12&tts=12&width=1140&nt=0&thu=0&trc=0&show_legend=yes&show_axis_titles=yes&show_tooltip=yes&id=MORTGAGE30US&scale=left&cosd=1971-04-02&coed=2025-01-16&line_color=%234572a7&link_values=False&line_style=solid&mark_type=none&mw=3&lw=3&ost=-99999&oet=99999&mma=0&fml=a&fq=Weekly%2C%20Ending%20Thursday&fam=avg&fgst=lin&fgsnd=2020-02-01&line_index=0&transformation=lin&vintage_date=2025-01-16&revision_date=2025-01-16&nd=1971-04-02","piedate":None,"lastModified":"Thu, 16 Jan 2025 17:06:02 GMT","obsFetch":False,"initialPayload":True},"xAxis":{},"yAxis":{},"seriesObjects":[{"type":"time-series","line_index":1,"legendIndex":1,"title":"30-Year Fixed Rate Mortgage Average in the United States","available_formula_transformations":{"lin":{"full":"","short":""},"chg":{"full":"Change","short":"Chg."},"ch1":{"full":"Change from Year Ago","short":"Chg. from Yr. Ago"},"pch":{"full":"Percent Change","short":"% Chg."},"pc1":{"full":"Percent Change from Year Ago","short":"% Chg. from Yr. Ago"},"pca":{"full":"Compounded Annual Rate of Change","short":"Comp. Annual Rate of Chg."},"cch":{"full":"Continuously Compounded Rate of Change","short":"Cont. Comp. Rate of Chg."},"cca":{"full":"Continuously Compounded Annual Rate of Change","short":"Cont. Comp. Annual Rate of Chg."},"log":{"full":"Natural Log","short":"Log"},"nbd":{"full":"Index (Scale value to 100 for chosen period)","short":"Index"}},"line_color":"#4572a7","line_style":"solid","lw":3,"mark_type":"none","hide_marks":True,"mw":3,"scale":"left","decimal_places":"2","frequency":"Weekly","fq":"Weekly, Ending Thursday","available_colors":{"1":"#4572A7","2":"#AA4643","3":"#89A54E","4":"#80699B","5":"#3D96AE","6":"#DB843D","7":"#92A8CD","8":"#A47D7C","9":"#B5CA92","10":"#91e8e1","11":"#8d4653","12":"#8085e8"},"available_fams":{"Average":"avg","Sum":"sum","End of Period":"eop"},"fam":"avg","available_fqs":["Weekly, Ending Thursday","Biweekly, Ending Wednesday","Biweekly, Ending Monday","Monthly","Quarterly","Semiannual","Annual"],"fml":"a","fgst":"lin","fgsnd":"2020-02-01","all_fred_series_have_same_frequency":True,"has_fred_series_with_nbd_transformation":False,"cosd":"1971-04-02","coed":"2025-01-16","min_date":"1971-04-02","max_date":"2025-01-16","year_range":54,"ost":-99999,"oet":99999,"available_mmas":[0,1,2],"mma":0,"graph_series_ids":["MORTGAGE30US"],"series_objects":{"a":{"series_id":"MORTGAGE30US","title":"30-Year Fixed Rate Mortgage Average in the United States","season":"Not Seasonally Adjusted","season_short":"NSA","frequency":"Weekly","frequency_short":"W","units_short":"%","keywords":"   ","all_obs_transformations":{"lin":"Percent","cap":"Percent per Capita","chg":"Change, Percent","ch1":"Change from Year Ago, Percent","pch":"Percent Change","pc1":"Percent Change from Year Ago","pca":"Compounded Annual Rate of Change","cch":"Continuously Compounded Rate of Change","cca":"Continuously Compounded Annual Rate of Change"},"abbreviated_all_obs_transformations":{"lin":"Levels","cap":"Levels per Capita","chg":"Chg.","ch1":"Chg. from Yr. Ago","pch":"% Chg.","pc1":"% Chg. from Yr. Ago","pca":"Comp. Annual Rate of Chg.","cch":"Cont. Comp. Rate of Chg.","cca":"Cont. Comp. Annual Rate of Chg.","log":"Log"},"obs_transformations":{"lin":"Percent","chg":"Change, Percent","ch1":"Change from Year Ago, Percent","pch":"Percent Change","pc1":"Percent Change from Year Ago","pca":"Compounded Annual Rate of Change","cch":"Continuously Compounded Rate of Change","cca":"Continuously Compounded Annual Rate of Change"},"valid_start_date":"2025-01-16","valid_end_date":"2025-01-16","vintage_date":"2025-01-16","available_revision_dates":["2025-01-16"],"revision_date":"2025-01-16","relative_vintage":None,"nd":"1971-04-02","step_line":"f","transformation":"lin","available_units":{"lin":"Percent","chg":"Change, Percent","ch1":"Change from Year Ago, Percent","pch":"Percent Change","pc1":"Percent Change from Year Ago","pca":"Compounded Annual Rate of Change","cch":"Continuously Compounded Rate of Change","cca":"Continuously Compounded Annual Rate of Change"},"units":"Percent","min_valid_start_date":"2025-01-16","max_valid_start_date":None,"min_obs_start_date":"1971-04-02","max_obs_start_date":"2025-01-16","last_updated":"2025-01-16 11:06:02-06"}},"lsv":None,"lev":None,"observation_grouping_approximation":"close","chart_key":"b5493067f49e8aaa5bd1f051d0a682f7"}],"fredLogo":{"width":105,"height":22,"image":"https://fred.stlouisfed.org/images/fredgraph-logo-2x.png"},"container":{"width":1140,"height":450},"defaultFontSize":12,"defaultMaxTicks":10,"showNavigator":True,"showCredits":True,"dataParams":{},"dataUrl":"https://fred-sa.stlouisfed.org/graph/graph-data.php","graphBreakpointWidth":400,"observations":{},"axisTitleHeight":300,"titleWidth":975,"alignTicks":True,"borderRadius":0,"recessionBars":"on","spacingBottom":15,"spacingTop":50,"spacingRight":20,"zoomType":"x","style":{"fontFamily":"Open Sans","color":"color: rgb(68, 68, 68)"},"chartTypes":{"line":"LINE","area":"AREA","column":"BAR","scatter":"PLOT","pie":"SEGMENT"},"chartTypeIcons":{"line":"fa-chart-line","area":"fa-chart-area","column":"fa-chart-bar","pie":"fa-chart-pie","scatter":""}}

headers = {
    'Content-Type': 'application/json',
}

# Send the POST request
response = requests.post(url, json=data, headers=headers)
API_Response_Code=response.status_code
print('API_Response_Code: ',API_Response_Code)


json_str=response.json()
data=json.dumps(json_str)
parsed_data = json.loads(data)
parsed_data
observations = parsed_data.get('observations', [])
observations
# observations data back to a JSON string
observations_json = json.dumps(observations, indent=2)
flattened_data = [(timestamp, value) for sublist in observations for timestamp, value in sublist]
flattened_data
df = pd.DataFrame(flattened_data, columns=["Timestamp", "Value"])
df['Date'] = pd.to_datetime(df['Timestamp'], unit='ms', origin='unix')
df['Year'] = df['Date'].dt.year
df['Quarter'] = df['Date'].dt.to_period('Q')
df = df.drop(columns=['Timestamp', 'Date'])
df
